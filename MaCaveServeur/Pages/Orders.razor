@page "/orders"
@using MaCaveServeur.Services
@inject OrderService OrderSvc

<h1>üßæ Commandes ‚Äî P√©nuries d√©tect√©es</h1>

<div class="card">
  <p>Liste des r√©f√©rences <b>sous le seuil</b> par √©tablissement et fournisseur.</p>
</div>

@if (_rows == null)
{
  <div class="card">Chargement‚Ä¶</div>
}
else if (_rows.Count == 0)
{
  <div class="card">Aucune p√©nurie pour le moment ‚úÖ</div>
}
else
{
  <div class="card">
    <table class="pure-table pure-table-striped" style="width:100%;">
      <thead>
        <tr>
          <th>Fournisseur</th>
          <th>Site</th>
          <th>Producteur</th>
          <th>Nom</th>
          <th>Mill√©sime</th>
          <th>Qt√©</th>
          <th>Seuil</th>
          <th>Prix achat</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var r in _rows.OrderBy(x => x.Supplier).ThenBy(x => x.Site).ThenBy(x => x.Producer).ThenBy(x => x.Name))
        {
          <tr>
            <td>@r.Supplier</td>
            <td>@r.Site</td>
            <td>@r.Producer</td>
            <td>@r.Name</td>
            <td>@(r.Vintage==0?"‚Äî":r.Vintage)</td>
            <td>@r.CurrentQty</td>
            <td>@r.LowStockThreshold</td>
            <td>@r.PurchasePrice.ToString("0.00") ‚Ç¨</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="card">
    <NavLink class="btn primary" href="/orders/bulk">Pr√©parer les bons group√©s</NavLink>
  </div>
}

@code {
  private List<OrderService.ShortageLine>? _rows;

  protected override void OnInitialized()
  {
    _rows = OrderSvc.GetShortages();
  }
}
